# Arduino 机械臂控制器

基于Arduino的舵机控制系统，用于ERCC ROS赛项中的机械臂抓取操作。

## 项目概述

这个Arduino程序控制舵机电机进行机械臂的抓取/释放操作。它通过串口通信与主ROS系统进行通信，接收抓取命令并执行平滑的舵机运动。

## 功能特性

- **舵机控制**：精确控制舵机电机进行抓取/释放操作
- **平滑运动**：使用线性插值实现舵机平滑移动
- **串口通信**：采用带校验和验证的帧协议

## 硬件要求

- Arduino兼容微控制器
- 舵机电机（连接到引脚5）
- 与ROS系统的串口连接（115200波特率）

## 引脚配置

| 组件 | 引脚 | 描述 |
|------|------|------|
| 舵机电机 | 5 | PWM控制信号 |

## 通信协议

### 数据帧格式
系统使用4字节通信帧：

```
[帧头] [命令] [校验和] [帧尾]
 0x6B  0x00/01   BCC    0x6D
```

### 帧结构
- **帧头 (0x6B)**：帧开始标识符
- **命令**：控制命令字节
  - `0x00`：打开抓手（移动到0°）
  - `0x01`：关闭抓手（移动到70°）
- **校验和**：BCC（块校验字符）- 帧头和命令的异或
- **帧尾 (0x6D)**：帧结束标识符

### 命令示例
```
打开抓手：  [0x6B] [0x00] [0x6B] [0x6D]
关闭抓手：  [0x6B] [0x01] [0x6A] [0x6D]
```

## 舵机配置

| 参数 | 数值 | 描述 |
|------|------|------|
| 初始角度 | 0° | 起始位置 |
| 打开角度 | 0° | 抓手打开位置 |
| 关闭角度 | 70° | 抓手关闭位置 |
| 移动步长 | 1° | 每步角度增量 |
| 移动延时 | 25ms | 步与步之间的时间 |


## ROS集成

此Arduino处理器通过`robot_bringup`节点与ROS系统集成：

- **ROS话题**：`/grab` (std_msgs/Int32)
  - 值 `0`：打开抓手
  - 值 `1`：关闭抓手
- **串口**：`/dev/arduino-device`（可在ROS参数中配置）
- **波特率**：115200

## 安装和设置

### Arduino IDE
1. 在Arduino IDE中打开`arm_handler.ino`
2. 选择合适的开发板和端口
3. 上传到Arduino

### PlatformIO
```bash
pio run --target upload
```

## 依赖项
- Arduino Servo库（内置）

## 配置

关键参数可在代码顶部修改：

```cpp
const int SERVO_PIN = 5;        // 舵机控制引脚
const int ANGLE_OPEN = 0;       // 打开位置角度
const int ANGLE_CLOSE = 70;     // 关闭位置角度
const int MOVE_STEP = 1;        // 移动步长
const int MOVE_DELAY = 25;      // 步延时(ms)
```


